# CI/CD Setup for Tetris

## Configuration GitHub Actions

Ce projet utilise GitHub Actions pour le CI/CD automatique.

### Secrets requis

Vous devez configurer le secret suivant dans les paramètres GitHub de votre repository :

1. Allez sur `Settings` > `Secrets and variables` > `Actions`
2. Cliquez sur `New repository secret`
3. Créez un secret nommé `KUBECONFIG` avec la valeur suivante :

```
YXBpVmVyc2lvbjogdjEKY2x1c3RlcnM6CiAgICAtIGNsdXN0ZXI6CiAgICAgICAgY2VydGlmaWNhdGUtYXV0aG9yaXR5LWRhdGE6IExTMHRMUzFDUlVkSlRpQkRSVkpVU1VaSlEwRlVSUzB0TFMwdENrMUpTVVprYWtORFFWSXlaMEYzU1VKQlowbENRVVJCUzBKblozRm9hMnBQVUZGUlJFRnFRV3BOVTBWM1NIZFpSRlpSVVVSRVFtaHlUVE5OZEdNeVZua0taRzFXZVV4WFRtaFJSRVV6VG1wUk5VNUVXVE5PUkUxM1NHaGpUazFxVlhoTmFrRXhUVlJSTVU5VVFYcFhhR05PVFhwVmVFMXFRWHBOVkZFeFQxUkJlZ3BYYWtGcVRWTkZkMGgzV1VSV1VWRkVSRUpvY2swelRYUmpNbFo1WkcxV2VVeFhUbWhSUkVVelRtcFJOVTVFV1ROT1JFMTNWMVJCVkVKblkzRm9hMnBQQ2xCUlNVSkNaMmR4YUd0cVQxQlJUVUpDZDA1RFFVRlNZMHh4U1VWdWRHUlZjVFpOVmswcmFsUjNiRWRwZUZablpVODFja00wYW5sd2JuVjJUazFvZEhnS01URndObm81VWpKaVZrbE5TM1JaUkU1c1NsQjZhRVZKV21neFFtMWFWVk00U2s1SVRWUnlNalJwWmpodk1FbDNVVVJCVDBKblRsWklVVGhDUVdZNFJRcENRVTFEUVhGUmQwUjNXVVJXVWpCVVFWRklMMEpCVlhkQmQwVkNMM3BCWkVKblRsWklVVFJGUm1kUlZYbDRjMWh0TXpoUFNWcEJaakV4VHpaYVZuVkdDa1pLYWl0R1pUaDNRMmRaU1V0dldrbDZhakJGUVhkSlJGSjNRWGRTUVVsblNrWkZSV1Z6YzJReFQzYzBjR2QwVW1VeWFVVlBkRkE1S3pKdmVWTXJjMElLY21WSE9HVkVSWE4xZEUxRFNVUnNXSGR5Y0RGSlF5OUdXbkl4WkdscFp6UnpSbG93VFZCdk1qSkZVa1Z3WkZSVmRsUTVSSEZrZWxnS0xTMHRMUzFGVGtRZ1EwVlNWRWxHU1VOQlZFVXRMUzB0TFFvPQogICAgICAgIHNlcnZlcjogaHR0cHM6Ly8xMjcuMC4wLjE6NjQ0MwogICAgICBuYW1lOiBkZWZhdWx0CmNvbnRleHRzOgogICAgLSBjb250ZXh0OgogICAgICAgIGNsdXN0ZXI6IGRlZmF1bHQKICAgICAgICB1c2VyOiBkZWZhdWx0CiAgICAgICAgbmFtZXNwYWNlOiBwb3J0Zm9saW8KICAgICAgbmFtZTogZGVmYXVsdApjdXJyZW50LWNvbnRleHQ6IGRlZmF1bHQKa2luZDogQ29uZmlnCnByZWZlcmVuY2VzOiB7fQp1c2VyczoKICAgIC0gbmFtZTogZGVmYXVsdAogICAgICB1c2VyOgogICAgICAgIGNsaWVudC1jZXJ0aWZpY2F0ZS1kYXRhOiBMUzB0TFMxQ1JVZEpUaUJEUlZKVVNVWkpRMEZVUlMwdExTMHRDazFKU1VKcmFrTkRRVlJsWjBGM1NVSkJaMGxKU1NzeU5FSnRObnBMTm1kM1EyZFpTVXR2V2tsNmFqQkZRWGRKZDBsNlJXaE5RamhIUVRGVlJVRjNkMWtLWVhwT2VreFhUbk5oVjFaMVpFTXhhbGxWUVhoT2Vsa3dUMVJSTWs1NlVYcE5RalJZUkZSSk1VMVVTWGRPVkVVd1RsUnJkMDB4YjFoRVZFa3lUVlJKZHdwT1ZFVXdUbFJyZDAweGIzZE5SRVZZVFVKVlIwRXhWVVZEYUUxUFl6TnNlbVJIVm5SUGJURm9Zek5TYkdOdVRYaEdWRUZVUW1kT1ZrSkJUVlJFU0U0MUNtTXpVbXhpVkhCb1drY3hjR0pxUWxwTlFrMUhRbmx4UjFOTk5EbEJaMFZIUTBOeFIxTk5ORGxCZDBWSVFUQkpRVUpEWm5Zck5URk9iR0ZGVlVwR1l6UUtaVXhZYzFCVVdrcFBTakY0ZFdGaGFYWm5lVlV2Tkd3NWNVWldSbEZPYW01cmFIaHRiR3hCWkhJdmNHb3hXVXN2YkRBM2FWbFNSM1ZHTjJwd1pXbEpZUXB0YWs5TVVGaFBhbE5FUWtkTlFUUkhRVEZWWkVSM1JVSXZkMUZGUVhkSlJtOUVRVlJDWjA1V1NGTlZSVVJFUVV0Q1oyZHlRbWRGUmtKUlkwUkJha0ZtQ2tKblRsWklVMDFGUjBSQlYyZENVWFpvVVhSRWFVWk1hRGhKZDJoWlRHSkxRV295Y21VNGNYRkZha0ZMUW1kbmNXaHJhazlRVVZGRVFXZE9Ta0ZFUWtjS1FXbEZRWGxpVFZSR2JEVTBkMUJGZDIwMEwwOXlVVFpxZGk4eU5qQkdTMjB4ZW5KQmRFTTVZbGxZVWxoWmNYZERTVkZEVm10NlNrWmtUVkVyZHpGM2VncDNlRk0yZUdreVNHUXlWRUZIWldWQkx5dE5XVUpDYVc5dFZUZzFWbEU5UFFvdExTMHRMVVZPUkNCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2kwdExTMHRRa1ZIU1U0Z1EwVlNWRWxHU1VOQlZFVXRMUzB0TFFwTlNVbENaSHBEUTBGU01tZEJkMGxDUVdkSlFrRkVRVXRDWjJkeGFHdHFUMUJSVVVSQmFrRnFUVk5GZDBoM1dVUldVVkZFUkVKb2NrMHpUWFJaTW5od0NscFhOVEJNVjA1b1VVUkZNMDVxVVRWT1JGa3pUa1JOZDBob1kwNU5hbFY0VFdwQk1VMVVVVEZQVkVGNlYyaGpUazE2VlhoTmFrRjZUVlJSTVU5VVFYb0tWMnBCYWsxVFJYZElkMWxFVmxGUlJFUkNhSEpOTTAxMFdUSjRjRnBYTlRCTVYwNW9VVVJGTTA1cVVUVk9SRmt6VGtSTmQxZFVRVlJDWjJOeGFHdHFUd3BRVVVsQ1FtZG5jV2hyYWs5UVVVMUNRbmRPUTBGQlVsZDNWbmRHV20xb1ltRmtkbVpaUzNWWFIxbG9RbFpVVnk4NVdWSkZNemd4WkRaNVNYcE9TVmh6Q205aFRXTnVkekJGWTJwdFRUVklUSFJ4U2xkeVpqRkVTbVIzYWxjekt6UlZjRm9yV0ZabVIwVmpNbEo1YnpCSmQxRkVRVTlDWjA1V1NGRTRRa0ZtT0VVS1FrRk5RMEZ4VVhkRWQxbEVWbEl3VkVGUlNDOUNRVlYzUVhkRlFpOTZRV1JDWjA1V1NGRTBSVVpuVVZWTU5GVk1VVFJvVXpSbVEwMUpWME15ZVdkSk9RcHhNM1pMY1doSmQwTm5XVWxMYjFwSmVtb3dSVUYzU1VSVFFVRjNVbEZKYUVGUGFuWm1URVoyU2k5Tk9XbGlVemxXYUZZMVdGZHpNaTlxU3pOUmVrMW1DblZWZW1sWFNXUXpTWGxoSzBGcFFuQlNTR1JSTTBsSE5XcEVLMmQwTDJKdE5HcG1kV2hvT0dkNVdWQk5iR1JKSzA5T1QyOHJORXRtZUhjOVBRb3RMUzB0TFVWT1JDQkRSVkpVU1VaSlEwRlVSUzB0TFMwdENnPT0KICAgICAgICBjbGllbnQta2V5LWRhdGE6IExTMHRMUzFDUlVkSlRpQkZReUJRVWtsV1FWUkZJRXRGV1MwdExTMHRDazFJWTBOQlVVVkZTVTlIWkRCak9VSTJValZ3UTJScFdtdFBaR2MyU0dGRVEzcG1jbEpHUWpCNVJFOXNXREJaWkZWek1HRnZRVzlIUTBOeFIxTk5ORGtLUVhkRlNHOVZVVVJSWjBGRlNpc3ZOMjVWTWxadlVsRnJWbnBvTkhSbGR6bE9hMnMwYmxoSE5YQnhTeXRFU2xRdmFWZ3liMVpWVmtFeVQyVlRTRWRoVndwVlFqSjJLMjFRVm1keUsxaFVkVXBvUldFMFdIVlBiRFpKYUhGaFRUUnpPV04zUFQwS0xTMHRMUzFGVGtRZ1JVTWdVRkpKVmtGVVJTQkxSVmt0TFMwdExRbz0K
```

**Note**: Cette valeur doit être encodée en base64 de votre fichier kubeconfig.

### Workflow

Le workflow se déclenche automatiquement à chaque push sur la branche `main` et effectue :

1. **Build & Push** :
   - Construction de l'image Docker avec BuildKit
   - Push vers GitHub Container Registry (ghcr.io)
   - Utilisation du cache pour accélérer les builds

2. **Deploy** :
   - Application des manifests Kubernetes
   - Restart du deployment
   - Vérification du statut du déploiement

### Permissions

Le workflow utilise automatiquement `GITHUB_TOKEN` pour pousser les images vers GHCR. Aucune configuration supplémentaire n'est nécessaire.

### Accès à l'application

Une fois déployée, l'application est accessible sur :
- **Production**: https://tetris.louis-sylvestre.dev

### Vérification manuelle

Pour vérifier le déploiement manuellement :

```bash
kubectl get pods -n tetris
kubectl get ingress -n tetris
kubectl logs -n tetris -l app=tetris --tail=50
```
